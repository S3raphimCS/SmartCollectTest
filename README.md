# Payout Service API

REST-—Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞—è–≤–∫–∞–º–∏ –Ω–∞ –≤—ã–ø–ª–∞—Ç—É —Å—Ä–µ–¥—Å—Ç–≤.
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–∞ **Django** + **DRF** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **Celery** –¥–ª—è —Ñ–æ–Ω–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á.

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

*   **–Ø–∑—ã–∫:** Python 3.13
*   **–§—Ä–µ–π–º–≤–æ—Ä–∫:** Django 5.2, Django REST Framework
*   **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å:** Celery, Redis
*   **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** PostgreSQL
*   **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:** Docker, Docker Compose
*   **–ü–∞–∫–µ—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä:** Poetry
*   **–¢–µ—Å—Ç—ã:** Pytest
*   **–õ–∏–Ω—Ç–µ—Ä—ã:** Ruff 

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ (Docker)

–î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã –æ–±–µ—Ä–Ω—É—Ç—ã –≤ `Makefile`. –ú–æ–∂–µ—Ç–µ —Å –Ω–∏–º–∏ –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è –≤–≤–µ–¥—è `make help`

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ (–º–æ–∂–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä):
```bash
cp .env.example .env
```

### 2. –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞
–°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (Web, Database, Redis, Celery Worker, Celery Beat):
```bash
make build
```

### 3. –î–æ–±–∞–≤—å—Ç–µ –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è –≤ Nginx PM (localhost:81)
–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç. 
–û—Ç–∫—Ä–æ–π—Ç–µ `Hosts` -> `Proxy Host` -> `Add proxy host`.

–£–∫–∞–∂–∏—Ç–µ –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, localhost, –ø–æ—Å–ª–µ —á–µ–≥–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:

Forward Hostname - app

Forward Port - 8000

(–õ–∏–±–æ –º–æ–∂–Ω–æ –Ω–∞ nginx:80, –Ω–æ —Ç–æ–≥–¥–∞ –Ω–∞–¥–æ —É–∫–∞–∑—ã–≤–∞—Ç—å custom locations –Ω–∞ —Å—Ç–∞—Ç–∏–∫—É)

###  –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
–í –ø—Ä–æ–µ–∫—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Ç–µ—Å—Ç–∞–º—ã (Pytest) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–æ–∫–æ–≤ –¥–ª—è Celery.

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Ruff.

–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
```bash
make test
```
–ó–∞–ø—É—Å–∫ –ª–∏–Ω—Ç–µ—Ä–∞
```bash
make lint
```

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å–∞–º:
- Swagger UI: http://localhost/api/v1/swagger
–û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:
- GET /api/v1/payouts/ ‚Äî –°–ø–∏—Å–æ–∫ –≤—ã–ø–ª–∞—Ç (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é, –ø–æ–∏—Å–∫, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É).
- POST /api/v1/payouts/ ‚Äî –°–æ–∑–¥–∞–Ω–∏–µ –≤—ã–ø–ª–∞—Ç—ã (–∑–∞–ø—É—Å–∫–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –∑–∞–¥–∞—á—É).
- GET /api/v1/payouts/{id}/ ‚Äî –î–µ—Ç–∞–ª–∏ –≤—ã–ø–ª–∞—Ç—ã.

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–µ–ø–ª–æ—è (Production)
–î–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –≤ Production-—Å—Ä–µ–¥–µ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

1. CI/CD Pipeline (GitHub Actions / GitLab CI):
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ (pytest) –∏ –ª–∏–Ω—Ç–µ—Ä–æ–≤ (ruff) –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø—É—à–µ.
   - –°–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –µ–≥–æ –≤ Container Registry.
2. –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
   - –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è: Kubernetes –∏–ª–∏ Docker Swarm –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏.
   - Web-—Å–µ—Ä–≤–µ—Ä: Gunicorn (–∑–∞–ø—É—â–µ–Ω–Ω—ã–π –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞) –∑–∞ –æ–±—Ä–∞—Ç–Ω—ã–º –ø—Ä–æ–∫—Å–∏ Nginx (–¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏ –∏ SSL).
   - Database: PostgreSQL.
   - Broker: Managed Redis (AWS ElastiCache) –¥–ª—è –æ—á–µ—Ä–µ–¥–µ–π –∑–∞–¥–∞—á.
3. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
   - –°–µ–∫—Ä–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–∫–ª—é—á–∏, –ø–∞—Ä–æ–ª–∏) –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (Vault –∏–ª–∏ Kubernetes Secrets).
   DEBUG=False –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ.
4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
   - Sentry: –î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.
   - Prometheus + Grafana: –î–ª—è —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.
   - ELK/Loki+Promtail: –î–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –ª–æ–≥–æ–≤
   - Jaeger: –î–ª—è —Ç—Ä–µ–π—Å–∏–Ω–≥–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
SmartCollectTest
‚îú‚îÄ‚îÄ deploy/                 # Dockerfiles –∏ —Å–∫—Ä–∏–ø—Ç—ã –∑–∞–ø—É—Å–∫–∞
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ server/                 # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –±—ç–∫–µ–Ω–¥–∞
‚îÇ       ‚îú‚îÄ‚îÄ apps/               # –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è Django (payouts –∏ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏)
‚îÇ       ‚îú‚îÄ‚îÄ api/                # API –ø—Ä–æ–µ–∫—Ç–∞
‚îÇ       ‚îú‚îÄ‚îÄ tests/              # –¢–µ—Å—Ç—ã
‚îÇ       ‚îú‚îÄ‚îÄ celery_app.py
‚îÇ       ‚îú‚îÄ‚îÄ settings.py
‚îÇ       ‚îú‚îÄ‚îÄ .env
‚îÇ       ‚îú‚îÄ‚îÄ .env.example
‚îú   ‚îú‚îÄ‚îÄmanage.py
‚îú‚îÄ‚îÄ celery_app.py
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ Makefile
‚îú‚îÄ‚îÄ pyproject.toml          # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –∫–æ–Ω—Ñ–∏–≥–∏ (Poetry, Ruff, Pytest)
‚îî‚îÄ‚îÄ README.md
```